<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>VFind - Profil</title>
  <link rel="stylesheet" href="style/main.css"/>
</head>
<body class="vfind-bg">

<!-- ✅ HEADER PROFIL cohérent avec SOLO -->
<header class="header-solo">
  <div class="header-row">
    <a href="index.html" class="back-btn">←</a>
    <h1>Mon Profil</h1>
    <div class="top-buttons">
      <a href="profil.html" class="btn-icon">👤</a>
      <a href="parametres.html" class="btn-icon">⚙️</a>
    </div>
  </div>
</header>

<!-- ✅ Bloc solde -->
<section class="profil-top">
  <div class="profil-solde-bar">
    <div class="solde-piece">
      <img src="assets/img/vcoin.webp" alt="VCoins" class="vcoin-solo" />
      <span id="vcoins">100</span>
    </div>
    <div class="solde-jeton">
      <img src="assets/img/jeton_p.webp" alt="Jetons" class="jeton-solo" />
      <span id="jetons">6</span>
    </div>
  </div>
</section>

<!-- ✅ Boutons sections -->
<main class="profil-container">
  <section class="profil-sections">
    <button onclick="location.href='cadres.html'">🎨 Mes cadres</button>
    <button onclick="location.href='amis.html'">👥 Mes amis</button>
    <h2 style="margin:1em 0 0.5em;">📅 Mon calendrier</h2>
    <button onclick="location.href='historique.html'">📜 Historique</button>
    <button onclick="location.href='photos_aimees.html'">❤️ Photos aimées</button>
    <button onclick="location.href='photos_signalees.html'">🚩 Photos signalées</button>
  </section>

  <!-- ✅ Container calendrier caché au départ -->
  <div id="calendrier-container" style="display:none; margin-top:1em;"></div>
</main>

<footer>
  <p>© 2025 VFind</p>
</footer>

<!-- ✅ Script dynamique -->
<script src="js/userData.js"></script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const data = typeof getUserData === "function" ? getUserData() : {};
  document.getElementById("vcoins").textContent = data.Vcoins || 0;
  document.getElementById("jetons").textContent = data.jetons || 0;

document.addEventListener("DOMContentLoaded", () => {
  const data = typeof getUserData === "function" ? getUserData() : {};
  document.getElementById("vcoins").textContent = data.Vcoins || 0;
  document.getElementById("jetons").textContent = data.jetons || 0;

  afficherCalendrier(); // affichage direct au chargement
});


  function afficherCalendrier() {
    const historique = JSON.parse(localStorage.getItem('vfindHistorique')) || [];
    const parJour = {};
    historique.forEach(entree => {
      const dateStr = entree.date.split(',')[0].split('/').reverse().join('-');
      if (!parJour[dateStr]) parJour[dateStr] = [];
      parJour[dateStr].push(entree);
    });

    const today = new Date();
    const annee = today.getFullYear();
    const mois = today.getMonth();
    const premierJour = new Date(annee, mois, 1);
    const nbJours = new Date(annee, mois + 1, 0).getDate();

    let html = '<div class="calendrier">';
    html += '<div class="sem">Lun</div><div class="sem">Mar</div><div class="sem">Mer</div><div class="sem">Jeu</div><div class="sem">Ven</div><div class="sem">Sam</div><div class="sem">Dim</div>';
    let decal = (premierJour.getDay() + 6) % 7;
    html += '<div class="vide" style="grid-column:1/span '+decal+';"></div>'.repeat(decal);

    for (let j = 1; j <= nbJours; j++) {
      const d = new Date(annee, mois, j);
      const dstr = d.toISOString().slice(0, 10);
      const sessions = parJour[dstr] || [];

      let vertFonce = false;
      let totalDefis = 0;
      sessions.forEach(s => {
        if ((s.defis && s.defis.length === 3) || (s.defis_duel && s.defis_duel.length === 3)) vertFonce = true;
        totalDefis += (s.defis ? s.defis.length : 0) + (s.defis_duel ? s.defis_duel.length : 0);
      });

      let color = "#ff2c2c";
      if (vertFonce) color = "#089e29";
      else if (totalDefis > 0) color = "#baffc7";

      html += `<div class="jour" style="background:${color}">${j}</div>`;
    }
    html += "</div>";
    document.getElementById('calendrier-container').innerHTML = html;
  }

  const style = document.createElement('style');
  style.textContent = `
    #calendrier-container { margin: 1.5em 0; }
    .calendrier { display: grid; grid-template-columns: repeat(7, 38px); gap: 7px; }
    .calendrier .jour {
      border-radius: 50%; width: 38px; height: 38px; display: flex; align-items: center; justify-content: center;
      font-weight: bold; font-size: 1.1rem; box-shadow: 0 1px 4px #0002; cursor: pointer; transition: .2s;
    }
    .calendrier .jour:hover { box-shadow: 0 2px 8px #0003; transform: scale(1.06); }
    .calendrier .sem {
      font-size: .95em; font-weight: 600; color: #666; text-align: center;
    }
  `;
  document.head.appendChild(style);
});
</script>
</body>
</html>
